version: "3"

tasks:
  # Development Tools
  templ:
    desc: Run templ with integrated server and hot reload
    cmds:
      - go tool templ generate --watch --cmd="go run ./cmd/server/main.go" --proxy="http://localhost:42069" --open-browser=false

  tailwind-build:
    desc: Build tailwind output (prod-ish)
    cmds:
      - ./tailwindcss -i ./static/css/input.css -o ./static/css/output.css --minify

  tailwind-clean:
    desc: Clean tailwind output
    cmds:
      - ./tailwindcss -i ./static/css/input.css -o ./static/css/output.css --clean

  tailwind-watch:
    desc: Run tailwindcss in watch mode
    cmds:
      - ./tailwindcss -i ./static/css/input.css -o ./static/css/output.css --watch

  ts-build:
    desc: Bundle TS into static/* (prod-ish)
    cmds:
      - esbuild ./static/ts/src/board.ts
        --bundle
        --format=esm
        --target=es2022
        --minify
        --outfile=./static/js/board.js

  ts-watch:
    desc: Watch+rebuild board bundle
    cmds:
      - esbuild ./static/ts/src/board.ts
        --bundle
        --format=esm
        --target=es2022
        --sourcemap
        --outfile=./static/js/board.js
        --watch

  # Start development server
  dev:
    desc: Start development server with hot reload
    deps:
      - tailwind-build
    cmds:
      - echo "Starting app..."
      - sleep 1
      - task --parallel tailwind-watch templ ts-watch
